<div class="content" appDragDrop
     (filesDropped)="onFilesDropped($event)"
     (fileOverChange)="onFileOverChange($event)"
     [class.file-over]="fileOver">

  <!-- Error Message -->
  @if (dashboardError) {
    <div class="error-message">
      <mat-icon>error</mat-icon>
      <span>{{ dashboardError }}</span>
      <button mat-button (click)="loadDashboardData()">Retry</button>
    </div>
  }

  <!-- Recently Edited Section -->
  <h2 class="section-title">Recently Edited</h2>
  <div class="recently-edited">
    @if (isLoadingRecentFiles) {
      <div class="loading-state">
        <mat-icon class="spinner">refresh</mat-icon>
        <span>Loading recent files...</span>
      </div>
    } @else if (recentlyEditedFiles.length === 0) {
      <div class="empty-state">
        <mat-icon>folder_open</mat-icon>
        <span>No recently edited files</span>
      </div>
    } @else {
      @for(file of recentlyEditedFiles.slice(0, 4); track file.id) {
        <div class="file-card">
          <div class="file-preview" [style.background]="getGradientBackground(file.type)">
            <div class="file-preview-content">
              <div class="file-preview-icon">
                <i class="fas" [class]="getFileIconClass(file.type)"></i>
              </div>
              <small>{{ getFileCategory(file.type) }}</small>
            </div>
            <div class="file-card-actions">
              <i class="fas fa-ellipsis-h"></i>
            </div>
          </div>
          <div class="file-card-body">
            <div class="file-card-title">{{ file.name }}</div>
            <div class="file-card-meta">{{ file.lastModified }}</div>
          </div>
        </div>
      }
    }
  </div>

  <!-- File Type Distribution Section -->
  <h2 class="section-title">File Distribution</h2>
  <div class="file-distribution">
    @if (isLoadingDashboard) {
      <div class="loading-state">
        <mat-icon class="spinner">refresh</mat-icon>
        <span>Loading file distribution...</span>
      </div>
    } @else if (fileTypeDistribution.length === 0) {
      <div class="empty-state">
        <mat-icon>folder_open</mat-icon>
        <span>No files to display</span>
      </div>
    } @else {
      @for(item of fileTypeDistribution; track item.type) {
        <div class="distribution-item">
          <div class="distribution-label">
            <span class="distribution-type">{{ item.type }}</span>
            <span class="distribution-count">{{ item.count }} files</span>
          </div>
          <div class="distribution-bar">
            <div class="distribution-bar-fill"
                 [style.width.%]="item.percentage"
                 [style.background-color]="item.color">
            </div>
          </div>
          <div class="distribution-percent">{{ item.percentage }}%</div>
        </div>
      }
    }
  </div>

  <!-- Storage Stats -->
  <h2 class="section-title">Storage</h2>
  <div class="storage-widget">
    @if (isLoadingDashboard) {
      <div class="loading-state">
        <mat-icon class="spinner">refresh</mat-icon>
        <span>Loading storage statistics...</span>
      </div>
    } @else {
      <div class="storage-info">
        <div class="storage-used">
          <span class="storage-amount">{{ formatFileSize(storageUsed) }}</span>
          @if (storageTotal > 0) {
            <span class="storage-total">of {{ formatFileSize(storageTotal) }} used</span>
          } @else {
            <span class="storage-total">used</span>
          }
        </div>
        <div class="storage-percentage">{{ storagePercentage }}%</div>
      </div>
      @if (storageTotal > 0) {
        <div class="storage-bar">
          <div class="storage-bar-fill" [style.width.%]="storagePercentage"></div>
        </div>
      }
      <div class="storage-breakdown">
        <div class="breakdown-item">
          <i class="fas fa-file" style="color: #667eea;"></i>
          <span>Documents: {{ formatFileSize(documentsSize) }}</span>
        </div>
        <div class="breakdown-item">
          <i class="fas fa-image" style="color: #f093fb;"></i>
          <span>Images: {{ formatFileSize(imagesSize) }}</span>
        </div>
        <div class="breakdown-item">
          <i class="fas fa-video" style="color: #4facfe;"></i>
          <span>Videos: {{ formatFileSize(videosSize) }}</span>
        </div>
        <div class="breakdown-item">
          <i class="fas fa-music" style="color: #f5576c;"></i>
          <span>Audio: {{ formatFileSize(audioSize) }}</span>
        </div>
        <div class="breakdown-item">
          <i class="fas fa-folder" style="color: #00f2fe;"></i>
          <span>Other: {{ formatFileSize(otherSize) }}</span>
        </div>
      </div>
    }
  </div>
</div>
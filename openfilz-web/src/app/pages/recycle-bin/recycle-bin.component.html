<div class="recycle-bin-container">
  <!-- Toolbar with custom recycle bin actions -->
  <app-toolbar
    [viewMode]="viewMode"
    [hasSelection]="hasSelectedItems"
    [selectionCount]="selectedItems.length"
    [pageIndex]="pageIndex"
    [pageSize]="pageSize"
    [totalItems]="totalItems"
    [showUploadButton]="false"
    [showCreateFolderButton]="false"
    [showStandardSelectionActions]="false"
    (viewModeChange)="onViewModeChange($event)"
    (clearSelection)="onClearSelection()"
    (previousPage)="onPreviousPage()"
    (nextPage)="onNextPage()"
    (pageSizeChange)="onPageSizeChange($event)">

    <!-- Breadcrumb projected into toolbar for mobile visibility -->
    <div toolbarBreadcrumb class="toolbar-breadcrumb-compact">
      @if(breadcrumbTrail.length > 0) {
        <button mat-icon-button (click)="navigateBack()"
                aria-label="Navigate back"
                class="breadcrumb-back-btn">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <mat-icon class="separator">chevron_right</mat-icon>
        <span class="breadcrumb-text">{{ breadcrumbTrail[breadcrumbTrail.length - 1].name }}</span>
      } @else {
        <button mat-icon-button (click)="navigateToHome()"
                aria-label="Recycle Bin"
                class="breadcrumb-home-btn">
          <mat-icon>delete</mat-icon>
        </button>
        <span class="breadcrumb-text">Recycle Bin</span>
      }
    </div>

    <!-- Custom recycle bin actions projected into toolbar -->
    <div toolbarActions class="recycle-bin-actions">
      <button mat-raised-button
              color="primary"
              (click)="restoreSelected()"
              [disabled]="selectedItemsCount === 0"
              matTooltip="Restore selected items"
              class="restore-btn">
        <mat-icon>restore</mat-icon>
        <span>Restore</span>
      </button>
      <button mat-raised-button
              color="warn"
              (click)="permanentlyDeleteSelected()"
              [disabled]="selectedItemsCount === 0"
              matTooltip="Permanently delete selected items"
              class="delete-forever-btn">
        <mat-icon>delete_forever</mat-icon>
        <span>Delete Forever</span>
      </button>
      <button mat-raised-button
              (click)="emptyRecycleBin()"
              [disabled]="items.length === 0"
              matTooltip="Empty entire recycle bin"
              class="empty-bin-btn">
        <mat-icon>delete_sweep</mat-icon>
        <span>Empty Bin</span>
      </button>
    </div>
  </app-toolbar>

  <div class="recycle-bin-content">
    @if (loading) {
      <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Loading recycle bin...</p>
      </div>
    }

    @if (!loading && items.length === 0) {
      <div class="empty-state">
        <mat-icon class="empty-icon">delete_outline</mat-icon>
        <h2>Recycle bin is empty</h2>
        <p>Deleted files and folders will appear here</p>
        <p class="info-text">Items are automatically deleted after 30 days</p>
      </div>
    }

    @if (!loading && items.length > 0) {
      @if (viewMode === 'grid') {
        <app-file-grid
          [items]="items"
          [showFavoriteButton]="false"
          (itemClick)="onItemClick($event)"
          (itemDoubleClick)="onItemDoubleClick($event)"
          (selectionChange)="onSelectionChange($event)"
          (toggleFavorite)="onToggleFavorite($event)"
          (rename)="onRenameItem($event)"
          (download)="onDownloadItem($event)"
          (move)="onMoveItem($event)"
          (copy)="onCopyItem($event)"
          (delete)="onDeleteItem($event)">
        </app-file-grid>
      }

      @if (viewMode === 'list') {
        <app-file-list
          [items]="items"
          [showFavoriteButton]="false"
          (itemClick)="onItemClick($event)"
          (itemDoubleClick)="onItemDoubleClick($event)"
          (selectionChange)="onSelectionChange($event)"
          (selectAll)="onSelectAll($event)"
          (toggleFavorite)="onToggleFavorite($event)"
          (rename)="onRenameItem($event)"
          (download)="onDownloadItem($event)"
          (move)="onMoveItem($event)"
          (copy)="onCopyItem($event)"
          (delete)="onDeleteItem($event)">
        </app-file-list>
      }
    }
  </div>
</div>

<!-- Mobile FAB (Floating Action Button) -->
@if (items.length > 0) {
  <div class="recycle-bin-fab-container" [class.fab-open]="fabOpen">
    <!-- Main FAB -->
    <button mat-fab color="primary" class="main-fab"
            (click)="toggleFab()"
            [attr.aria-label]="fabOpen ? 'Close actions menu' : 'Open actions menu'"
            [attr.aria-expanded]="fabOpen">
      <mat-icon [class.fab-icon-rotated]="fabOpen" aria-hidden="true">
        {{ fabOpen ? 'close' : 'menu' }}
      </mat-icon>
    </button>

    <!-- Speed Dial Actions -->
    @if (fabOpen) {
      <div class="fab-speed-dial" role="menu" aria-label="Recycle bin actions">
        @if (selectedItemsCount > 0) {
          <div class="speed-dial-item">
            <button mat-mini-fab class="speed-dial-btn restore-dial-btn"
                    (click)="onRestoreFromFab()"
                    aria-label="Restore selected items"
                    role="menuitem">
              <mat-icon aria-hidden="true">restore</mat-icon>
            </button>
            <span class="speed-dial-label restore-label">Restore</span>
          </div>

          <div class="speed-dial-item">
            <button mat-mini-fab class="speed-dial-btn delete-forever-dial-btn"
                    (click)="onDeleteForeverFromFab()"
                    aria-label="Permanently delete selected items"
                    role="menuitem">
              <mat-icon aria-hidden="true">delete_forever</mat-icon>
            </button>
            <span class="speed-dial-label delete-forever-label">Delete Forever</span>
          </div>
        }

        <div class="speed-dial-item">
          <button mat-mini-fab class="speed-dial-btn empty-bin-dial-btn"
                  (click)="onEmptyBinFromFab()"
                  aria-label="Empty entire recycle bin"
                  role="menuitem">
            <mat-icon aria-hidden="true">delete_sweep</mat-icon>
          </button>
          <span class="speed-dial-label empty-bin-label">Empty Bin</span>
        </div>
      </div>
    }

    <!-- Backdrop overlay -->
    @if (fabOpen) {
      <div class="fab-backdrop" (click)="closeFab()" aria-hidden="true"></div>
    }
  </div>
}
